"use strict";const e=require("../../common/vendor.js"),a=require("../../api/apis.js");if(!Array){(e.resolveComponent("uni-search-bar")+e.resolveComponent("uni-icons")+e.resolveComponent("uv-empty")+e.resolveComponent("uni-load-more"))()}Math||((()=>"../../uni_modules/uni-search-bar/components/uni-search-bar/uni-search-bar.js")+(()=>"../../uni_modules/uni-icons/components/uni-icons/uni-icons.js")+(()=>"../../uni_modules/uv-empty/components/uv-empty/uv-empty.js")+(()=>"../../uni_modules/uni-load-more/components/uni-load-more/uni-load-more.js"))();const o={__name:"search",setup(o){const l=e.ref({pageNum:1,pageSize:12,keyword:""}),n=e.ref(e.index.getStorageSync("historySearch")||[]),u=e.ref(["美女","帅哥","宠物","卡通"]),t=e.ref(!1),i=e.ref(!1),r=e.ref([]),s=()=>{e.index.showLoading(),n.value=[...new Set([l.value.keyword,...n.value])].slice(0,10),e.index.setStorageSync("historySearch",n.value),p(l.value.keyword),m(),console.log(l.value.keyword)},v=()=>{p()},c=e=>{p(e),s()},d=()=>{e.index.showModal({title:"是否清空历史搜索？",success:a=>{a.confirm&&(e.index.removeStorageSync("historySearch"),n.value=[])}})},m=async()=>{try{let o=await a.apiSearchData(l.value);r.value=[...r.value,...o.data],e.index.setStorageSync("limitData",r.value),l.value.pageSize>o.data.length&&(t.value=!0),0==o.data.length&&0==r.value.length&&(i.value=!0),console.log(o)}finally{e.index.hideLoading()}},p=(e="")=>{r.value=[],t.value=!1,i.value=!1,l.value={pageNum:1,pageSize:12,keyword:e||""}};return e.onReachBottom((()=>{t.value||(l.value.pageNum++,m())})),e.onUnload((()=>{e.index.removeStorageSync("storgClassList",r.value)})),(a,o)=>e.e({a:e.o(s),b:e.o(v),c:e.o(v),d:e.o((e=>l.value.keyword=e)),e:e.p({focus:!0,placeholder:"搜索",modelValue:l.value.keyword}),f:!r.value.length||i.value},!r.value.length||i.value?e.e({g:n.value.length},n.value.length?{h:e.p({type:"trash",size:"25"}),i:e.o(d),j:e.f(n.value,((a,o,l)=>({a:e.t(a),b:a,c:e.o((e=>c(a)),a)})))}:{},{k:e.f(u.value,((a,o,l)=>({a:e.t(a),b:a,c:e.o((e=>c(a)),a)})))}):{},{l:i.value},i.value?{m:e.p({mode:"search",icon:"http://cdn.uviewui.com/uview/empty/search.png"})}:e.e({n:e.f(r.value,((e,a,o)=>({a:e.smallPicurl,b:`/pages/detail/detail?id=${e._id}`,c:e._id}))),o:t.value||r.value.length},t.value||r.value.length?{p:e.p({status:t.value?"noMore":"loading"})}:{}))}},l=e._export_sfc(o,[["__scopeId","data-v-1375c7e6"]]);wx.createPage(l);

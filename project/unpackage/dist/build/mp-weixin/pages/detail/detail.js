"use strict";const e=require("../../common/vendor.js"),a=require("../../utils/system.js"),l=require("../../api/apis.js");if(!Array){(e.resolveComponent("uni-icons")+e.resolveComponent("uni-dateformat")+e.resolveComponent("uni-rate")+e.resolveComponent("uni-popup"))()}Math||((()=>"../../uni_modules/uni-icons/components/uni-icons/uni-icons.js")+(()=>"../../uni_modules/uni-dateformat/components/uni-dateformat/uni-dateformat.js")+(()=>"../../uni_modules/uni-rate/components/uni-rate/uni-rate.js")+(()=>"../../uni_modules/uni-popup/components/uni-popup/uni-popup.js"))();const o={__name:"detail",setup(o){e.onLoad((e=>{c.value=e.id,console.log(c.value),d.value=r.value.findIndex((e=>e._id==c.value)),t.value=r.value[d.value],i()}));const u=async()=>{try{e.index.showLoading({title:"加载中..."});let{classid:a,_id:o}=t.value,u=await l.apiGetUserDownLoadData({classid:a,wallId:o});if(0!=u.errCode)throw u;e.index.getImageInfo({src:t.value.picurl,success:a=>{e.index.saveImageToPhotosAlbum({filePath:a.path,success:a=>{e.index.showToast({title:"保存成功",icon:"none"})},fail:a=>{"saveImageToPhotosAlbum:fail cancel"!=a.errMsg?(console.log(a),e.index.showModal({title:"授权提示",content:"请打开相册保存权限",success:a=>{a.confirm&&e.index.openSetting({success(a){a.authSetting["scope.writePhotosAlbum"]?e.index.showToast({title:"授权成功",icon:"none"}):e.index.showToast({title:"授权失败",icon:"none"})}})}})):e.index.showToast({title:"下载失败，请重新下载",icon:"none"})},complete:()=>{e.index.hideLoading()}})}})}catch(a){e.index.hideLoading()}},t=e.ref(null),n=e.ref([]);function i(){n.value.push(d.value-1<=-1?r.value.length-1:d.value-1,d.value,d.value+1>=12?0:d.value+1),n.value=[...new Set(n.value)]}let s=e=>{d.value=e.detail.current,t.value=r.value[d.value],i()};const r=e.ref([]);let v=e.index.getStorageSync("limitData")||[];r.value=v.map((e=>({...e,picurl:e.smallPicurl.replace("_small.webp",".jpg")})));const c=e.ref(),d=e.ref(),p=e.ref(!0),m=()=>{p.value=!p.value},f=e.ref(null),h=()=>{f.value.open()},g=()=>{f.value.close()},w=e.ref(null),x=()=>{t.value.userScore&&(S.value=!0,_.value=t.value.userScore),w.value.open()},y=()=>{w.value.close(),_.value=0,S.value=!1},_=e.ref(0),S=e.ref(!1),b=async()=>{e.index.showLoading({title:"加载中"});let{classid:a,_id:o}=t.value,u=await l.apiGetUserScortData({classid:a,wallId:o,userScore:_.value});e.index.hideLoading(),0===u.errCode&&(e.index.showToast({title:"评分成功",icon:"none"}),r.value[d.value].userScore=_.value,e.index.setStorageSync("limitData",r.value),y())},j=()=>{e.index.navigateBack()};return(l,o)=>{var i,v,c,D,I,L,k;return e.e({a:t.value},t.value?e.e({b:e.f(r.value,((a,l,o)=>e.e({a:n.value.includes(l)},n.value.includes(l)?{b:e.o(m,a._id),c:a.picurl}:{},{d:a._id}))),c:d.value,d:e.o(((...a)=>e.unref(s)&&e.unref(s)(...a))),e:p.value},p.value?{f:e.p({type:"left",size:"24",color:"#fff"}),g:e.o(j),h:e.unref(a.getStatusHeightValue)()+"px",i:e.t(d.value+1),j:e.t(r.value.length),k:e.p({date:new Date,format:"hh:mm"}),l:e.p({date:new Date,format:"MM月dd日"}),m:e.p({type:"info",size:"24"}),n:e.o(h),o:e.p({type:"star",size:"24"}),p:e.t(null==(i=t.value)?void 0:i.score),q:e.o(x),r:e.p({type:"download",size:"22"}),s:e.o(u)}:{},{t:e.p({type:"close",size:"22"}),v:e.o(g),w:e.t(null==(v=t.value)?void 0:v._id),x:e.t(null==(c=t.value)?void 0:c.tabs[1]),y:e.t(null==(D=t.value)?void 0:D.nickname),z:e.p({readonly:!0,touchable:!1,value:null==(I=t.value)?void 0:I.score}),A:e.t(null==(L=t.value)?void 0:L.score),B:e.t(null==(k=t.value)?void 0:k.description),C:e.f(t.value.tabs,((a,l,o)=>({a:e.t(a),b:a}))),D:e.sr(f,"4a5ad16a-6",{k:"popupDetail"}),E:e.p({type:"bottom","safe-area":!1}),F:e.t(S.value?"已评分":"评分信息"),G:e.p({type:"close",size:"24"}),H:e.o(y),I:e.o((e=>_.value=e)),J:e.p({allowHalf:!0,readonly:S.value,modelValue:_.value}),K:e.t(_.value),L:e.o(b),M:!_.value||S.value,N:e.sr(w,"4a5ad16a-9",{k:"popupScore"}),O:e.p({type:"center","is-mask-click":!1})}):{})}}},u=e._export_sfc(o,[["__scopeId","data-v-4a5ad16a"]]);wx.createPage(u);
